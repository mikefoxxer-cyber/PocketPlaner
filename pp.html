<!doctype html>
<html lang="sk">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Pocket Planner ‚Äî Android style</title>
<link rel="icon" href="data:," />
<style>
  /* ========== Material-ish Android: dark theme ========== */
  :root{
    --bg:#0f1114;
    --surface:#141618;
    --card:#1b1d20;
    --muted:#9aa0a6;
    --accent:#ff6b6b; /* can be adapted by user */
    --accent-2:#7c4dff;
    --success:#32d74b;
    --radius:14px;
    --glass: rgba(255,255,255,0.02);
  }
  html,body{height:100%; margin:0; font-family: "Roboto", "Noto Sans", -apple-system, system-ui, "Segoe UI", "Helvetica Neue", Arial; background:linear-gradient(180deg,var(--bg),#0b0c0d); color:#e8eef1; -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;}
  .app{
    display:flex;
    flex-direction:column;
    min-height:100vh;
    padding:12px;
    box-sizing:border-box;
    gap:12px;
  }

  /* Top App Bar */
  .topbar{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:12px;
  }
  .brand{
    display:flex;
    gap:12px;
    align-items:center;
  }
  .logo{
    width:44px; height:44px; border-radius:10px; background:linear-gradient(135deg,var(--accent), var(--accent-2)); display:grid; place-items:center; font-weight:700; box-shadow: 0 8px 30px rgba(124,77,255,0.12);
  }
  .title{
    font-weight:700; font-size:18px;
  }
  .subtitle{font-size:12px; color:var(--muted); margin-top:-4px;}

  /* Main card area */
  .main{
    flex:1;
    display:flex;
    gap:12px;
    align-items:stretch;
  }

  /* Column / view area */
  .view{
    flex:1;
    background:linear-gradient(180deg,var(--surface), #0f1113);
    border-radius:var(--radius);
    padding:12px;
    box-shadow: 0 10px 30px rgba(2,4,6,0.6);
    border:1px solid rgba(255,255,255,0.03);
    overflow:auto;
    min-height:300px;
  }

  /* Event card */
  .event{
    display:flex;
    gap:12px;
    align-items:flex-start;
    padding:12px;
    border-radius:12px;
    background:linear-gradient(180deg,var(--card), rgba(255,255,255,0.02));
    margin-bottom:10px;
    border:1px solid rgba(255,255,255,0.02);
  }
  .badge{
    width:52px; height:52px; border-radius:12px; display:grid; place-items:center; font-weight:700; font-size:14px; color:white;
  }
  .content{flex:1; min-width:0;}
  .ename{font-weight:700; font-size:15px; margin-bottom:6px; word-break:break-word;}
  .emeta{font-size:13px; color:var(--muted); display:flex; gap:10px; align-items:center; flex-wrap:wrap;}
  .etag{background:rgba(255,255,255,0.02); padding:4px 8px; border-radius:999px; font-size:12px;}

  .controls{display:flex; gap:8px; align-items:center;}
  .icbtn{width:40px;height:40px;border-radius:10px;display:grid;place-items:center;background:transparent;border:1px solid rgba(255,255,255,0.03); cursor:pointer;}
  .icbtn:hover{transform:translateY(-3px); transition:all .12s;}

  /* Floating action button */
  .fab{
    position:fixed;
    right:18px;
    bottom:84px;
    width:64px; height:64px; border-radius:32px;
    background:linear-gradient(135deg,var(--accent),var(--accent-2));
    display:grid; place-items:center; color:white; font-size:28px;
    box-shadow: 0 18px 40px rgba(124,77,255,0.18);
    cursor:pointer;
    border: none;
  }

  /* Bottom Navigation */
  .bottomnav{
    height:62px;
    background:linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.01));
    border-radius:12px;
    display:flex;
    gap:10px;
    padding:8px;
    align-items:center;
    justify-content:space-around;
    border:1px solid rgba(255,255,255,0.03);
  }
  .bitem{display:flex;flex-direction:column;align-items:center;gap:4px;color:var(--muted); font-size:12px; cursor:pointer;}
  .bitem.active{color:var(--accent-2); transform:translateY(-4px);}

  /* Modal */
  .modal-back{
    position:fixed; inset:0; display:none; align-items:center; justify-content:center; background:rgba(4,6,8,0.6); z-index:60;
  }
  .modal{
    width:94%; max-width:720px; border-radius:16px; background:linear-gradient(180deg,#0f1113,#0c0d0e); padding:16px; border:1px solid rgba(255,255,255,0.04);
  }
  .field{display:flex; flex-direction:column; gap:6px; margin-bottom:10px;}
  .field input, .field select, .field textarea{padding:10px; border-radius:10px; border:1px solid rgba(255,255,255,0.04); background:transparent; color:inherit;}
  textarea{min-height:80px; resize:vertical;}
  .row{display:flex; gap:8px;}
  .chip{padding:6px 10px;border-radius:999px;background:rgba(255,255,255,0.02); font-size:13px; color:var(--muted);}

  /* tiny helpers */
  .muted{color:var(--muted); font-size:13px;}
  .small{font-size:12px; color:var(--muted);}
  .empty{text-align:center; color:var(--muted); padding:36px;}

  /* responsive */
  @media(max-width:720px){
    .main{flex-direction:column;}
    .view{min-height:420px;}
    .fab{right:14px; bottom:80px;}
  }
</style>
</head>
<body>
  <div class="app" role="application" aria-label="Pocket Planner">

    <!-- Top -->
    <div class="topbar">
      <div class="brand">
        <div class="logo">PP</div>
        <div>
          <div class="title">Pocket Planner</div>
          <div class="subtitle">Android style ‚Ä¢ r√Ωchlo napl√°nuj</div>
        </div>
      </div>

      <div style="display:flex;gap:10px;align-items:center;">
        <button class="icbtn" id="bellBtn" title="Whistle">üîî</button>
        <button class="icbtn" id="notifReqBtn" title="Povoli≈• upozornenia">üîî‚öô</button>
      </div>
    </div>

    <!-- Main content -->
    <div class="main">
      <main class="view" id="viewArea" aria-live="polite">
        <!-- dynamic content -->
      </main>
    </div>

    <!-- FAB -->
    <button class="fab" id="addBtn" title="Prida≈•">Ôºã</button>

    <!-- Bottom Navigation -->
    <nav class="bottomnav" role="navigation" aria-label="Hlavn√© menu">
      <div class="bitem active" data-view="today"><div>üìÖ</div><div>Dnes</div></div>
      <div class="bitem" data-view="calendar"><div>üóìÔ∏è</div><div>Kalend√°r</div></div>
      <div class="bitem" data-view="list"><div>üìã</div><div>Zoznam</div></div>
    </nav>
  </div>

  <!-- Modal: add/edit -->
  <div class="modal-back" id="modalBack">
    <div class="modal" role="dialog" aria-modal="true" aria-label="Add event">
      <h3 id="modalTitle">Nov√° udalos≈•</h3>
      <div id="formArea">
        <div class="field">
          <label>N√°zov</label>
          <input id="evt_title" type="text" placeholder="Napr. Rann√Ω tr√©ning">
        </div>
        <div class="row">
          <div style="flex:1;" class="field">
            <label>D√°tum</label>
            <input id="evt_date" type="date">
          </div>
          <div style="width:140px;" class="field">
            <label>ƒåas</label>
            <input id="evt_time" type="time">
          </div>
        </div>
        <div class="row">
          <div style="flex:1;" class="field">
            <label>Typ</label>
            <select id="evt_type">
              <option value="training">Tr√©ning</option>
              <option value="match">Z√°pas</option>
              <option value="other">In√©</option>
            </select>
          </div>
          <div style="width:160px;" class="field">
            <label>Priorita</label>
            <select id="evt_priority">
              <option value="low">N√≠zka</option>
              <option value="med" selected>Stredn√°</option>
              <option value="high">Vysok√°</option>
            </select>
          </div>
        </div>

        <div class="field">
          <label>Tagy (oddelen√© ƒçiarkou)</label>
          <input id="evt_tags" placeholder="≈°kola, kond√≠cia">
        </div>

        <div class="field">
          <label>Pr√≠lohy (linky oddel. nov√Ωm riadkom)</label>
          <textarea id="evt_links" placeholder="https://example.com"></textarea>
        </div>

        <div style="display:flex; gap:8px; justify-content:flex-end; margin-top:10px;">
          <button class="icbtn" id="cancelModal">Zru≈°i≈•</button>
          <button class="icbtn" id="saveModal" style="background:linear-gradient(135deg,var(--accent),var(--accent-2)); color:white;">Ulo≈æi≈•</button>
        </div>
      </div>
    </div>
  </div>

  <!-- audio whistle -->
  <audio id="whistle">
    <source src="https://www.fesliyanstudios.com/play-mp3/4383" type="audio/mpeg">
  </audio>

<script>
/* Pocket Planner - Android-style single-file app
   - localStorage persistence
   - views: today, calendar (simple), list
   - notifications (day-of) and whistle sound
*/

/* ---------- Storage ---------- */
const LS_KEY = 'pocketplanner_v1';
let store = JSON.parse(localStorage.getItem(LS_KEY) || 'null');
if(!store) store = { events: [] };

/* ---------- Helpers ---------- */
const uid = (p='id') => p + '_' + Math.random().toString(36).slice(2,9);
const save = () => localStorage.setItem(LS_KEY, JSON.stringify(store));
const todayISO = () => new Date().toISOString().split('T')[0];
const formatTime = (d) => { const dt = new Date(d); return dt.toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'}); }
const dateTimeStr = (date, time) => {
  if(!date) return '';
  if(!time) return date;
  return date + ' ' + time;
};

/* ---------- UI refs ---------- */
const viewArea = document.getElementById('viewArea');
const modalBack = document.getElementById('modalBack');
const addBtn = document.getElementById('addBtn');
const modalTitle = document.getElementById('modalTitle');
const bellBtn = document.getElementById('bellBtn');
const notifReqBtn = document.getElementById('notifReqBtn');
const whistleAudio = document.getElementById('whistle');

/* modal inputs */
const f_title = document.getElementById('evt_title');
const f_date = document.getElementById('evt_date');
const f_time = document.getElementById('evt_time');
const f_type = document.getElementById('evt_type');
const f_priority = document.getElementById('evt_priority');
const f_tags = document.getElementById('evt_tags');
const f_links = document.getElementById('evt_links');
const saveModal = document.getElementById('saveModal');
const cancelModal = document.getElementById('cancelModal');

/* bottom nav */
document.querySelectorAll('.bitem').forEach(b=>{
  b.addEventListener('click', ()=>{
    document.querySelectorAll('.bitem').forEach(x=>x.classList.remove('active'));
    b.classList.add('active');
    render(b.dataset.view);
  });
});

/* ---------- App state ---------- */
let editingId = null;
let currentView = 'today';

/* ---------- Renderers ---------- */
function render(view='today'){
  currentView = view;
  viewArea.innerHTML = '';
  if(view === 'today'){
    renderToday();
  } else if(view === 'calendar'){
    renderCalendar();
  } else if(view === 'list'){
    renderList();
  }
}

function renderToday(){
  const today = todayISO();
  const todays = store.events.filter(e => e.date === today).sort((a,b)=> (a.time||'') > (b.time||'') ? 1 : -1);
  if(todays.length === 0){
    viewArea.innerHTML = `<div class="empty">Dnes ≈æiadne udalosti.</div>`;
    return;
  }
  todays.forEach(ev => viewArea.appendChild(eventCard(ev)));
}

function renderCalendar(){
  // simple grouped by date (future 14 days) - compact
  const frag = document.createDocumentFragment();
  const now = new Date();
  for(let i=0;i<14;i++){
    const d = new Date();
    d.setDate(now.getDate()+i);
    const iso = d.toISOString().split('T')[0];
    const dayEvents = store.events.filter(e => e.date === iso);
    if(dayEvents.length === 0) continue;
    const dayHeader = document.createElement('div');
    dayHeader.style.margin = '10px 0 6px';
    dayHeader.innerHTML = `<div style="font-weight:700;">${iso} ‚Ä¢ ${d.toLocaleDateString(undefined,{weekday:'short',day:'numeric',month:'short'})}</div>`;
    frag.appendChild(dayHeader);
    dayEvents.forEach(ev => frag.appendChild(eventCard(ev)));
  }
  if(!frag.childElementCount) viewArea.innerHTML = `<div class="empty">≈Ωiadne napl√°novan√© udalosti v najbli≈æ≈°√≠ch 14 d≈àoch.</div>`;
  else viewArea.appendChild(frag);
}

function renderList(){
  const sorted = store.events.slice().sort((a,b)=> (a.date + (a.time||'')) > (b.date + (b.time||'')) ? 1 : -1);
  if(sorted.length === 0){ viewArea.innerHTML = `<div class="empty">Zoznam je pr√°zdny ‚Äî pridaj udalos≈•.</div>`; return; }
  sorted.forEach(ev => viewArea.appendChild(eventCard(ev)));
}

function eventCard(ev){
  const el = document.createElement('div');
  el.className = 'event';
  // badge color
  let bg = 'linear-gradient(135deg,#2196F3,#7c4dff)';
  if(ev.type === 'match') bg = 'linear-gradient(135deg,#ff4b4b,#ff6b6b)';
  if(ev.type === 'other') bg = 'linear-gradient(135deg,#00c2a8,#32d74b)';
  const badge = document.createElement('div');
  badge.className = 'badge';
  badge.style.background = bg;
  badge.textContent = (ev.type === 'training' ? 'T' : ev.type === 'match' ? 'Z' : 'O');
  const content = document.createElement('div');
  content.className = 'content';
  const title = document.createElement('div');
  title.className = 'ename';
  title.textContent = ev.title;
  const meta = document.createElement('div');
  meta.className = 'emeta';
  const dt = document.createElement('div'); dt.textContent = `${ev.date}${ev.time ? ' ‚Ä¢ ' + ev.time : ''}`;
  const pr = document.createElement('div'); pr.className = 'etag'; pr.textContent = ev.priority ? ev.priority.toUpperCase() : '‚Äî';
  const tags = document.createElement('div'); tags.className = 'small'; tags.textContent = ev.tags?.join(', ') || '';
  meta.appendChild(dt); meta.appendChild(pr); if(tags.textContent) meta.appendChild(tags);
  content.appendChild(title); content.appendChild(meta);

  const controls = document.createElement('div');
  controls.className = 'controls';
  const editBtn = document.createElement('button'); editBtn.className='icbtn'; editBtn.innerHTML='‚úèÔ∏è';
  const delBtn = document.createElement('button'); delBtn.className='icbtn'; delBtn.innerHTML='üóëÔ∏è';
  const notifyBtn = document.createElement('button'); notifyBtn.className='icbtn'; notifyBtn.innerHTML='üîî';
  editBtn.title = 'Upravi≈•'; delBtn.title = 'Vymaza≈•'; notifyBtn.title = 'Nastavi≈• pripomienku';
  editBtn.onclick = ()=> openEdit(ev.id);
  delBtn.onclick = ()=> { if(confirm('Vymaza≈• udalos≈•?')) { store.events = store.events.filter(x=>x.id!==ev.id); save(); render(currentView); } };
  notifyBtn.onclick = ()=> scheduleImmediateNotification(ev);
  controls.appendChild(editBtn); controls.appendChild(notifyBtn); controls.appendChild(delBtn);

  el.appendChild(badge); el.appendChild(content); el.appendChild(controls);
  return el;
}

/* ---------- Modal handling ---------- */
addBtn.addEventListener('click', ()=> openNew());
cancelModal.addEventListener('click', closeModal);
modalBack.addEventListener('click', (e)=> { if(e.target === modalBack) closeModal(); });

function openNew(){
  editingId = null;
  modalTitle.textContent = 'Nov√° udalos≈•';
  f_title.value=''; f_date.value=''; f_time.value=''; f_type.value='training'; f_priority.value='med'; f_tags.value=''; f_links.value='';
  modalBack.style.display='flex';
}
function openEdit(id){
  const ev = store.events.find(e=>e.id===id);
  if(!ev) return;
  editingId = id;
  modalTitle.textContent = 'Upravi≈• udalos≈•';
  f_title.value = ev.title; f_date.value = ev.date; f_time.value = ev.time || ''; f_type.value = ev.type || 'training'; f_priority.value = ev.priority || 'med'; f_tags.value = (ev.tags||[]).join(','); f_links.value = (ev.links||[]).join('\n');
  modalBack.style.display='flex';
}
function closeModal(){ modalBack.style.display='none'; editingId = null; }

/* ---------- Save modal ---------- */
saveModal.addEventListener('click', ()=>{
  const title = f_title.value.trim();
  const date = f_date.value;
  const time = f_time.value;
  const type = f_type.value;
  const priority = f_priority.value;
  const tags = f_tags.value.split(',').map(s=>s.trim()).filter(Boolean);
  const links = f_links.value.split('\n').map(s=>s.trim()).filter(Boolean);

  if(!title || !date){ alert('N√°zov a d√°tum s√∫ povinn√©.'); return; }

  if(editingId){
    const ev = store.events.find(e=>e.id===editingId);
    if(!ev) return;
    ev.title = title; ev.date = date; ev.time = time; ev.type = type; ev.priority = priority; ev.tags = tags; ev.links = links; ev.updatedAt = new Date().toISOString();
  } else {
    const ev = { id: uid('ev'), title, date, time, type, priority, tags, links, createdAt: new Date().toISOString() };
    store.events.push(ev);
  }
  save();
  closeModal();
  render(currentView);
});

/* ---------- Notifications & whistle ---------- */
bellBtn.addEventListener('click', ()=> playWhistle());
notifReqBtn.addEventListener('click', requestNotificationPermission);

function playWhistle(){
  try{
    whistleAudio.currentTime = 0;
    whistleAudio.play();
  }catch(e){
    alert('Prehratie zvuku zablokovan√© ‚Äî klikni v prehliadaƒçi pre povolenie zvuku.');
  }
}

async function requestNotificationPermission(){
  if(!('Notification' in window)){ alert('Notifik√°cie nie s√∫ v tomto prehliadaƒçi podporovan√©.'); return; }
  const p = await Notification.requestPermission();
  if(p === 'granted') alert('Notifik√°cie povolen√©. Aplik√°cia bude pripom√≠na≈• z√°pasy d≈àa r√°no.');
  else alert('Notifik√°cie nepotvrden√©.');
}

/* Schedule daily morning check for today's matches (runs on page open and interval) */
function morningCheck(){
  const today = todayISO();
  const todayMatches = store.events.filter(e => e.type === 'match' && e.date === today);
  if(todayMatches.length > 0 && Notification.permission === 'granted'){
    // combine into single notification
    const titles = todayMatches.map(m=>m.title).slice(0,5).join(', ');
    const body = todayMatches.length > 1 ? `${todayMatches.length} z√°pasy dnes: ${titles}` : `Dnes: ${titles}`;
    new Notification('üì£ Dnes m√°≈° z√°pas!', { body, tag: 'pp-day-match' });
  }
}
// run at load and then every 30 minutes
morningCheck();
setInterval(morningCheck, 1000*60*30);

/* Allow scheduling immediate single-notification for one event (used by notify button) */
function scheduleImmediateNotification(ev){
  if(!('Notification' in window) || Notification.permission !== 'granted'){
    alert('Upozornenia nie s√∫ povolen√©. Klikni na üîî‚öô a povoƒæ ich.');
    return;
  }
  const when = ev.date + ' ' + (ev.time || '00:00');
  new Notification(`Pripomienka: ${ev.title}`, { body: `D√°tum: ${ev.date}${ev.time ? ' ‚Ä¢ ' + ev.time : ''}` });
}

/* ---------- Initial render ---------- */
render('today');

/* Optional: simple sample events for first-time user */
if(store.events.length === 0){
  store.events.push({ id: uid('ev'), title: 'Rann√Ω tr√©ning', date: todayISO(), time: '08:30', type:'training', priority:'med', tags:['kond√≠cia'], links:[], createdAt: new Date().toISOString() });
  store.events.push({ id: uid('ev'), title: 'Dom√°ci z√°pas', date: todayISO(), time: '17:00', type:'match', priority:'high', tags:['liga'], links:[], createdAt: new Date().toISOString() });
  save();
  render('today');
}
</script>
</body>
</html>
